<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>年末調整情報 確認画面</title>
    <link rel="icon" href="./favicon.jpg" type="image/jpeg">
    <link rel="apple-touch-icon" href="./logo-color-2.jpg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1e3656;
            --secondary-color: #5dade2;
            --accent-color: #e52128;
            --success-color: #27ae60;
            --light-gray: #f8f9fa;
            --medium-gray: #dee2e6;
            --dark-gray: #495057;
            --border-radius: 8px;
        }
        body {
            font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f4f7f9;
        }
        h1 {
            color: var(--primary-color);
            text-align: center;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 30px;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-top: 5px solid var(--secondary-color);
        }
        .section {
            margin-bottom: 30px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            padding: 20px;
            position: relative;
        }
        .section-title {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.2em;
            margin: -30px 0 20px -30px; /* Adjust margin to align with container edge */
            padding: 10px 30px; /* Padding inside the title bar */
            background-color: var(--light-gray); /* Light background for the title */
            border-bottom: 2px solid var(--secondary-color);
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            width: calc(100% + 60px); /* Extend beyond padding */
            box-sizing: border-box;
            padding-top: 25px; /* Adjust padding-top to compensate for negative margin */
            margin-top: -20px; /* Negative margin to overlap border */
            margin-left: -20px;
            margin-right: -20px;
            border-bottom: 1px solid var(--medium-gray); /* Lighter border for title bottom */
        }
        .section-content {
            padding-top: 40px; /* Push content down to clear the absolute title */
        }
        .data-row {
            display: flex;
            padding: 10px 0;
            border-bottom: 1px dashed var(--medium-gray);
            align-items: flex-start; /* Align items to the start for multi-line content */
        }
        .data-row:last-child {
            border-bottom: none;
        }
        .data-label {
            font-weight: bold;
            color: var(--primary-color);
            flex-basis: 35%; /* Adjust width for labels */
            padding-right: 15px;
            box-sizing: border-box;
        }
        .data-value {
            flex-basis: 65%; /* Adjust width for values */
            word-break: break-word;
        }
        .file-link {
            display: block;
            margin-bottom: 5px;
            color: var(--primary-color);
            text-decoration: none;
        }
        .file-link:hover {
            text-decoration: underline;
        }
        .no-data {
            color: #7f8c8d;
            font-style: italic;
        }
        @media (max-width: 600px) {
            body {
                padding: 0 10px;
            }
            h1 {
                font-size: 1.8em;
            }
            .container {
                padding: 20px;
            }
            .section {
                padding: 15px;
            }
            .section-title {
                font-size: 1.1em;
                margin: -25px 0 15px -25px;
                padding: 8px 25px;
                width: calc(100% + 50px);
                margin-top: -15px;
                margin-left: -15px;
                margin-right: -15px;
            }
            .section-content {
                padding-top: 35px;
            }
            .data-row {
                flex-direction: column;
                padding: 8px 0;
            }
            .data-label {
                flex-basis: 100%;
                padding-right: 0;
                margin-bottom: 3px;
                font-size: 0.9em;
            }
            .data-value {
                flex-basis: 100%;
                font-size: 0.95em;
            }
        }
    </style>
</head>
<body>

    <div style="text-align: center; margin-bottom: 20px;">
        <img src="./logo-color-2.jpg" alt="スタートアップ税理士法人 Logo" style="max-width: 180px;">
    </div>
    <h1>年末調整情報 確認</h1>

    <div id="data-container" class="container">
        </div>

    <script>
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwvQJgN_HG3j34Y1drCzF7i9ZDKu4OYnuUafQm1HFz9ngtGBa7sG0jbcDGpGHZm6SBBNg/exec'; // ここにデプロイしたGASのURLを設定
        
        async function loadData() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            const dataContainer = document.getElementById('data-container');

            if (!id) {
                dataContainer.innerHTML = '<p>表示するデータがありません。</p>';
                return;
            }

            try {
                const response = await fetch(`${GAS_WEB_APP_URL}?id=${id}`);
                const result = await response.json();

                if (result.result === 'success') {
                    renderData(result.data);
                } else {
                    dataContainer.innerHTML = `<p>データの読み込みに失敗しました: ${result.message}</p>`;
                }
            } catch (error) {
                dataContainer.innerHTML = `<p>データの読み込み中にエラーが発生しました: ${error}</p>`;
            }
        }

        function renderData(data) {
            const dataContainer = document.getElementById('data-container');
            dataContainer.innerHTML = ''; // Clear previous content

            const sections = {
                'ご本人情報': ['事業者名', 'メールアドレス', '姓', '名', '姓フリガナ', '名フリガナ', '生年月日', '郵便番号', '住所1', '住所2', '世帯主の氏名', '世帯主の続柄'],
                '年末調整実施確認': ['年末調整実施可否'],
                '令和7年(2025年)に入社された方': ['前職有無', '前職源泉徴収票', '前職源泉徴収票URL', '前職源泉徴収票FileName'],
                'その他収入について': ['その他収入有無', 'その他収入金額'],
                '住民税': ['住民税徴収方法'],
                '配偶者情報': [
                    '配偶者有無', '配偶者姓', '配偶者名', '配偶者姓フリガナ', '配偶者名フリガナ', '配偶者生年月日',
                    '配偶者_住所同じ', '配偶者住所1', '配偶者住所2',
                    '配偶者収入金額', '配偶者退職手当有無', '配偶者退職手当等金額',
                    '配偶者障害者手帳交付有無', '配偶者障害者手帳', '配偶者障害者手帳URL', '配偶者障害者手帳FileName', '配偶者障害者手帳備考'
                ],
                '扶養親族情報': [], // Will be populated dynamically
                '本人該当項目': [
                    '本人障害者手帳交付有無', '本人障害者手帳', '本人障害者手帳URL', '本人障害者手帳FileName', '本人障害者手帳備考',
                    '寡婦該当確認', 'ひとり親該当確認', '勤労学生該当確認', '勤労学生_学生証', '勤労学生_学生証URL', '勤労学生_学生証FileName', '災害者該当確認'
                ],
                '各種控除': [
                    '生命保険料控除有無', '生命保険料_控除証明書', '生命保険料_控除証明書URL', '生命保険料_控除証明書FileName',
                    '地震保険料控除有無', '地震保険料_控除証明書', '地震保険料_控除証明書URL', '地震保険料_控除証明書FileName',
                    '社会保険料控除有無', '国民健康保険料 支払対象者氏名', '国民健康保険料 年間支払額', '国民健康保険料 控除証明書', '国民健康保険料 控除証明書URL', '国民健康保険料 控除証明書FileName',
                    '国民年金保険料 控除証明書', '国民年金保険料 控除証明書URL', '国民年金保険料 控除証明書FileName',
                    '小規模企業共済掛金等控除有無', '小規模企業共済掛金等_控除証明書', '小規模企業共済掛金等_控除証明書URL', '小規模企業共済掛金等_控除証明書FileName',
                    '住宅ローン控除有無', '住宅ローン_申告書・証明書', '住宅ローン_申告書・証明書URL', '住宅ローン_申告書・証明書FileName'
                ]
            };

            // Dynamically add dependent fields
            for (let i = 1; i <= 6; i++) {
                sections['扶養親族情報'].push(
                    `扶養親族${i}_姓`, `扶養親族${i}_名`, `扶養親族${i}_姓フリガナ`, `扶養親族${i}_名フリガナ`,
                    `扶養親族${i}_続柄`, `扶養親族${i}_生年月日`,
                    `扶養親族${i}_住所同じ`, `扶養親族${i}_住所1`, `扶養親族${i}_住所2`,
                    `扶養親族${i}_収入金額`, `扶養親族${i}_退職手当有無`, `扶養親族${i}_退職手当等金額`,
                    `扶養親族${i}_障害者手帳交付有無`, `扶養親族${i}_障害者手帳`, `扶養親族${i}_障害者手帳URL`, `扶養親族${i}_障害者手帳FileName`, `扶養親族${i}_障害者手帳備考`
                );
            }

            for (const sectionTitle in sections) {
                const sectionDiv = document.createElement('div');
                sectionDiv.classList.add('section');
                
                const titleSpan = document.createElement('div');
                titleSpan.classList.add('section-title');
                titleSpan.textContent = sectionTitle;
                sectionDiv.appendChild(titleSpan);

                const contentDiv = document.createElement('div');
                contentDiv.classList.add('section-content');
                
                let sectionHasData = false;

                sections[sectionTitle].forEach(key => {
                    let value = data[key];
                    let displayLabel = key;

                    // Skip internal keys
                    if (key.endsWith('URL') || key.endsWith('FileName')) return;
                    
                    // Handle file inputs: display links if URLs exist
                    if (key.endsWith('前職源泉徴収票') || key.endsWith('配偶者障害者手帳') || key.endsWith('本人障害者手帳') ||
                        key.endsWith('勤労学生_学生証') || key.endsWith('生命保険料_控除証明書') || key.endsWith('地震保険料_控除証明書') ||
                        key.endsWith('国民健康保険料 控除証明書') || key.endsWith('国民年金保険料 控除証明書') ||
                        key.endsWith('小規模企業共済掛金等_控除証明書') || key.endsWith('住宅ローン_申告書・証明書') ||
                        key.match(/扶養親族\d+_障害者手帳/)) {
                        
                        const urlKey = key + 'URL';
                        const fileNameKey = key + 'FileName';
                        const urls = data[urlKey];
                        const fileNames = data[fileNameKey];
                        
                        if (urls && fileNames) {
                            const urlArray = urls.split('\n');
                            const fileNameArray = fileNames.split('\n');
                            if (urlArray.length > 0 && urlArray[0] !== '') {
                                const row = document.createElement('div');
                                row.classList.add('data-row');
                                row.innerHTML = `<div class="data-label">${displayLabel}</div><div class="data-value"></div>`;
                                const valueDiv = row.querySelector('.data-value');
                                urlArray.forEach((url, index) => {
                                    const fileName = fileNameArray[index] || 'ファイルを開く';
                                    const link = document.createElement('a');
                                    link.href = url;
                                    link.textContent = fileName;
                                    link.target = '_blank';
                                    link.rel = 'noopener noreferrer';
                                    link.classList.add('file-link');
                                    valueDiv.appendChild(link);
                                });
                                contentDiv.appendChild(row);
                                sectionHasData = true;
                                return;
                            }
                        }
                        value = ''; // No files or URLs, so set value to empty to be handled as no-data
                    }
                    
                    // Specific display logic for '配偶者_住所同じ' and '扶養親族X_住所同じ'
                    if (key.endsWith('_住所同じ') && value === 'true') {
                        const prefix = key.includes('配偶者') ? '配偶者' : `扶養親族${key.match(/扶養親族(\d+)_/)[1]}`;
                        const userAddress1 = data['住所1'] || '';
                        const userAddress2 = data['住所2'] || '';
                        const fullAddress = `${userAddress1}${userAddress2 ? ' ' + userAddress2 : ''}`.trim();
                        value = fullAddress ? `本人と同じ (${fullAddress})` : '本人と同じ';
                    } else if (key.endsWith('_住所同じ') && value === 'false') {
                         value = '本人とは異なる';
                    }

                    // Skip individual address lines if "_住所同じ" is true
                    if (key === '配偶者住所1' && data['配偶者_住所同じ'] === 'true') return;
                    if (key === '配偶者住所2' && data['配偶者_住所同じ'] === 'true') return;
                    for (let i = 1; i <= 6; i++) {
                        if (key === `扶養親族${i}_住所1` && data[`扶養親族${i}_住所同じ`] === 'true') return;
                        if (key === `扶養親族${i}_住所2` && data[`扶養親族${i}_住所同じ`] === 'true') return;
                    }
                    
                    if (value !== undefined && value !== null && String(value).trim() !== '') {
                        const row = document.createElement('div');
                        row.classList.add('data-row');
                        row.innerHTML = `<div class="data-label">${displayLabel}</div><div class="data-value">${value}</div>`;
                        contentDiv.appendChild(row);
                        sectionHasData = true;
                    }
                });
                
                if (sectionHasData) {
                    sectionDiv.appendChild(contentDiv);
                    dataContainer.appendChild(sectionDiv);
                } else {
                     // If section has no data (e.g., no spouse, no dependents), display a message or hide it
                     // For now, let's just not append the section if it has no content.
                     // If you want to show "該当なし" for empty sections, you can add:
                     // sectionDiv.appendChild(contentDiv);
                     // const noDataRow = document.createElement('div');
                     // noDataRow.classList.add('data-row');
                     // noDataRow.innerHTML = `<div class="data-label"></div><div class="data-value no-data">該当なし</div>`;
                     // contentDiv.appendChild(noDataRow);
                     // dataContainer.appendChild(sectionDiv);
                }
            }
        }

        window.onload = loadData;
    </script>
</body>
</html>